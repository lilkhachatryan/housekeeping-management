import React, { useState } from 'react';import { DragDropContext } from 'react-beautiful-dnd';import { Layout, Row, Col, Button } from 'antd';import { v4 as uuidv4 } from 'uuid';import HousekeeperColumn from './components/HousekeeperColumn';import UnassignedTasksPool from './components/UnassignedTasksPool';import AddTaskModal from './components/AddTaskModal';import mockTasks from "./data/mockTasks";import mockHousekeepers from "./data/mockHousekeepers";import './App.css';const { Header, Content } = Layout;function App() {    const [housekeepers, setHousekeepers] = useState(mockHousekeepers);    const [tasks, setTasks] = useState(mockTasks);    const [editingTask, setEditingTask] = useState(null);    const [isModalVisible, setIsModalVisible] = useState(false);    const updateTaskOrderNumbers = (tasks) => {        const sortedTasks = tasks.sort((a, b) => new Date(a.deadline) - new Date(b.deadline));        return sortedTasks.map((task, index) => ({            ...task,            title: `${index + 1} - ${task.title.split(" - ").slice(1).join(" - ")}`,        }));    };    const handleAddNewTaskClick = () => {        setEditingTask(null);        setIsModalVisible(true);    };    const handleEditTask = (task) => {        setEditingTask(task);        setIsModalVisible(true);    };    const handleDeleteTask = (taskId, housekeeperId = null) => {        if (housekeeperId) {            const newHousekeepers = housekeepers.map(housekeeper => {                if (housekeeper.id === housekeeperId) {                    const filteredTasks = housekeeper.tasks.filter(task => task.id !== taskId);                    return { ...housekeeper, tasks: updateTaskOrderNumbers(filteredTasks) };                }                return housekeeper;            });            setHousekeepers(newHousekeepers);        } else {            const filteredTasks = tasks.filter(task => task.id !== taskId);            setTasks(updateTaskOrderNumbers(filteredTasks));        }    };    const handleFormSubmit = (values) => {        if (editingTask) {            let taskUpdated = false;            // Update task in unassigned tasks            const updatedUnassignedTasks = tasks.map(task => {                if (task.id === editingTask.id) {                    taskUpdated = true;                    return {                        ...task,                        title: `${values.title.split(" - ")[0]} - ${values.title}`,                        duration: values.duration,                        deadline: values.deadline.format('YYYY-MM-DD HH:mm'),                        hotelApartment: values.hotelApartment                    };                }                return task;            });            // Update task in housekeepers' tasks            const updatedHousekeepers = housekeepers.map(housekeeper => {                const updatedTasks = housekeeper.tasks.map(task => {                    if (task.id === editingTask.id) {                        taskUpdated = true;                        return {                            ...task,                            title: `${values.title.split(" - ")[0]} - ${values.title}`,                            duration: values.duration,                            deadline: values.deadline.format('YYYY-MM-DD HH:mm'),                            hotelApartment: values.hotelApartment                        };                    }                    return task;                });                return {                    ...housekeeper,                    tasks: updateTaskOrderNumbers(updatedTasks)                };            });            if (taskUpdated) {                setHousekeepers(updatedHousekeepers);                if (!updatedHousekeepers.some(h => h.tasks.some(t => t.id === editingTask.id))) {                    setTasks(updateTaskOrderNumbers(updatedUnassignedTasks));                }            }        } else {            // Logic for adding a new task            const newTask = {                id: uuidv4(),                title: `${values.title.split(" - ")[0]} - ${values.title}`,                duration: values.duration,                deadline: values.deadline.format('YYYY-MM-DD HH:mm'),                hotelApartment: values.hotelApartment,            };            setTasks(updateTaskOrderNumbers([...tasks, newTask]));        }        setIsModalVisible(false);        setEditingTask(null);    };    const handleModalClose = () => {        setIsModalVisible(false);        setEditingTask(null);    };    // const onDragEnd = (result) => {    //     const { source, destination } = result;    //    //     if (!destination) {    //         return;    //     }    //    //     if (source.droppableId === destination.droppableId && source.index === destination.index) {    //         return;    //     }    //    //     const start = source.droppableId;    //     const finish = destination.droppableId;    //    //     if (start === finish) {    //         // Reordering in the same list    //         const housekeeperIndex = housekeepers.findIndex(h => `housekeeper-${h.id}` === start);    //         if (housekeeperIndex !== -1) {    //             // Reordering within a housekeeper's task list    //             const newTaskList = Array.from(housekeepers[housekeeperIndex].tasks);    //             const [reorderedItem] = newTaskList.splice(source.index, 1);    //             newTaskList.splice(destination.index, 0, reorderedItem);    //    //             const newHousekeepers = Array.from(housekeepers);    //             newHousekeepers[housekeeperIndex].tasks = newTaskList;    //             setHousekeepers(newHousekeepers);    //         } else if (start === 'unassignedTasksPool') {    //             // Reordering within unassigned tasks    //             const newTasks = Array.from(tasks);    //             const [reorderedItem] = newTasks.splice(source.index, 1);    //             newTasks.splice(destination.index, 0, reorderedItem);    //    //             // setTasks(newTasks);    //             setTasks(updateTaskOrderNumbers(newTasks)); // Update order numbers here    //         }    //     } else {    //         // Moving between lists    //         if (start === 'unassignedTasksPool') {    //             // Moving from unassigned to a housekeeper    //             const newTasks = Array.from(tasks);    //             const [movedItem] = newTasks.splice(source.index, 1);    //    //             const housekeeperIndex = housekeepers.findIndex(h => `housekeeper-${h.id}` === finish);    //             if (housekeeperIndex !== -1) {    //                 const newHousekeeperTasks = Array.from(housekeepers[housekeeperIndex].tasks);    //                 newHousekeeperTasks.splice(destination.index, 0, movedItem);    //    //                 const newHousekeepers = Array.from(housekeepers);    //                 newHousekeepers[housekeeperIndex].tasks = newHousekeeperTasks;    //    //                 setTasks(newTasks);    //                 setHousekeepers(newHousekeepers);    //             }    //         } else {    //             // Moving from a housekeeper to either unassigned or another housekeeper    //             const startHousekeeperIndex = housekeepers.findIndex(h => `housekeeper-${h.id}` === start);    //             const newStartTasks = Array.from(housekeepers[startHousekeeperIndex].tasks);    //             const [movedItem] = newStartTasks.splice(source.index, 1);    //    //             if (finish === 'unassignedTasksPool') {    //                 // Moving to unassigned tasks    //                 const newTasks = Array.from(tasks);    //                 newTasks.splice(destination.index, 0, movedItem);    //                 setTasks(newTasks);    //             } else {    //                 // Moving to another housekeeper    //                 const finishHousekeeperIndex = housekeepers.findIndex(h => `housekeeper-${h.id}` === finish);    //                 const newFinishTasks = Array.from(housekeepers[finishHousekeeperIndex].tasks);    //                 newFinishTasks.splice(destination.index, 0, movedItem);    //    //                 const newHousekeepers = Array.from(housekeepers);    //                 newHousekeepers[startHousekeeperIndex].tasks = newStartTasks;    //                 newHousekeepers[finishHousekeeperIndex].tasks = newFinishTasks;    //    //                 setHousekeepers(newHousekeepers);    //             }    //         }    //     }    //    //     const updatedHousekeepers = housekeepers.map(housekeeper => ({    //         ...housekeeper,    //         tasks: updateTaskOrderNumbers(housekeeper.tasks)    //     }));    //    //     setHousekeepers(updatedHousekeepers);    // };    // const onDragEnd = (result) => {    //     const { source, destination } = result;    //    //     if (!destination) {    //         return;    //     }    //    //     if (source.droppableId === destination.droppableId && source.index === destination.index) {    //         return;    //     }    //    //     const start = source.droppableId;    //     const finish = destination.droppableId;    //    //     if (start === finish) {    //         const housekeeperIndex = housekeepers.findIndex(h => `housekeeper-${h.id}` === start);    //         if (housekeeperIndex !== -1) {    //             // Reordering within the same housekeeper's task list    //             const newTaskList = Array.from(housekeepers[housekeeperIndex].tasks);    //             const [reorderedItem] = newTaskList.splice(source.index, 1);    //             newTaskList.splice(destination.index, 0, reorderedItem);    //    //             const newHousekeepers = Array.from(housekeepers);    //             newHousekeepers[housekeeperIndex].tasks = updateTaskOrderNumbers(newTaskList);    //             setHousekeepers(newHousekeepers);    //         } else if (start === 'unassignedTasksPool') {    //             // Reordering within unassigned tasks    //             const newTasks = Array.from(tasks);    //             const [reorderedItem] = newTasks.splice(source.index, 1);    //             newTasks.splice(destination.index, 0, reorderedItem);    //    //             setTasks(updateTaskOrderNumbers(newTasks));    //         }    //     } else {    //         // Moving between different lists    //         let movedItem;    //         let newStartTasks;    //    //         if (start === 'unassignedTasksPool') {    //             newStartTasks = Array.from(tasks);    //             [movedItem] = newStartTasks.splice(source.index, 1);    //             setTasks(newStartTasks);    //         } else {    //             const startHousekeeperIndex = housekeepers.findIndex(h => `housekeeper-${h.id}` === start);    //             newStartTasks = Array.from(housekeepers[startHousekeeperIndex].tasks);    //             [movedItem] = newStartTasks.splice(source.index, 1);    //    //             const newHousekeepers = Array.from(housekeepers);    //             newHousekeepers[startHousekeeperIndex].tasks = newStartTasks;    //             setHousekeepers(newHousekeepers);    //         }    //    //         if (finish === 'unassignedTasksPool') {    //             setTasks(updateTaskOrderNumbers([...tasks, movedItem]));    //    //         } else {    //             const finishHousekeeperIndex = housekeepers.findIndex(h => `housekeeper-${h.id}` === finish);    //             const newFinishTasks = [...housekeepers[finishHousekeeperIndex].tasks, movedItem];    //    //             const newHousekeepers = Array.from(housekeepers);    //    //             newHousekeepers[finishHousekeeperIndex].tasks = updateTaskOrderNumbers(newFinishTasks);    //             setHousekeepers(newHousekeepers)    //         }    //     }    // };    const onDragEnd = (result) => {        const { source, destination } = result;        // Exit if dropped outside the list        if (!destination) {            return;        }        const sourceId = source.droppableId;        const destinationId = destination.droppableId;        // Working with a clone of the housekeepers array        let newHousekeepers = [...housekeepers];        let newUnassignedTasks = [...tasks];        if (sourceId === destinationId) {            // Reordering within the same list            const isUnassignedTask = sourceId === 'unassignedTasksPool';            const taskList = isUnassignedTask ? newUnassignedTasks : newHousekeepers.find(h => `housekeeper-${h.id}` === sourceId).tasks;            // Remove the item and insert it at the new index            const [reorderedItem] = taskList.splice(source.index, 1);            taskList.splice(destination.index, 0, reorderedItem);            if (!isUnassignedTask) {                // Update task order numbers for the housekeeper                newHousekeepers.find(h => `housekeeper-${h.id}` === sourceId).tasks = updateTaskOrderNumbers(taskList);            } else {                // Update unassigned tasks                newUnassignedTasks = updateTaskOrderNumbers(taskList);            }        } else {            // Moving between different lists            const startTaskList = sourceId === 'unassignedTasksPool' ? newUnassignedTasks : newHousekeepers.find(h => `housekeeper-${h.id}` === sourceId).tasks;            const finishTaskList = destinationId === 'unassignedTasksPool' ? newUnassignedTasks : newHousekeepers.find(h => `housekeeper-${h.id}` === destinationId).tasks;            // Remove the item from the source and add it to the destination            const [movedItem] = startTaskList.splice(source.index, 1);            finishTaskList.splice(destination.index, 0, movedItem);            if (sourceId !== 'unassignedTasksPool') {                newHousekeepers.find(h => `housekeeper-${h.id}` === sourceId).tasks = updateTaskOrderNumbers(startTaskList);            }            if (destinationId !== 'unassignedTasksPool') {                newHousekeepers.find(h => `housekeeper-${h.id}` === destinationId).tasks = updateTaskOrderNumbers(finishTaskList);            } else {                newUnassignedTasks = updateTaskOrderNumbers(finishTaskList);            }        }        // Update the state        setHousekeepers(newHousekeepers);        setTasks(newUnassignedTasks);    };    return (        <Layout>            <Header>                <Button type="primary" onClick={handleAddNewTaskClick}>                    Add New Task                </Button>                {isModalVisible && <AddTaskModal                    isModalVisible={isModalVisible}                    handleFormSubmit={handleFormSubmit}                    handleModalClose={handleModalClose}                    editingTask={editingTask}                />}            </Header>            <Content style={{ padding: '20px', height: '100vh' }}>                <DragDropContext onDragEnd={onDragEnd}>                    <Row gutter={16}>                        <Col span={6}>                            <UnassignedTasksPool                                tasks={tasks}                                handleDeleteTask={handleDeleteTask}                                handleEditTask={handleEditTask}                            />                        </Col>                        {housekeepers.map((housekeeper) => (                            <Col key={housekeeper.id} span={6}>                                <HousekeeperColumn                                    housekeeper={housekeeper}                                    handleDeleteTask={handleDeleteTask}                                    handleEditTask={handleEditTask}                                />                            </Col>                        ))}                    </Row>                </DragDropContext>            </Content>        </Layout>    );}export default App;